<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Coach Dashboard ‚Ä¢ Sports Team Management</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Simple fade animation for tab switching */
    .tab-content { animation: fadeIn 0.3s ease-in-out; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* Calendar Scrollbar for many events */
    .calendar-day {
        min-height: 120px;
        max-height: 120px;
        overflow-y: auto; 
    }
    /* Hide scrollbar for cleaner look */
    .calendar-day::-webkit-scrollbar { display: none; }
    .calendar-day { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
  <header class="bg-white border-b">
  <div class="max-w-screen-2xl mx-auto px-6 py-4 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <span class="text-2xl">üèÜ</span>
      <div>
        <h1 class="text-xl font-semibold">Sports Team Management</h1>
        <p class="text-sm text-gray-500">
          Welcome back, {{ request.user.first_name|default:request.user.username|default:"coach" }}!
        </p>
      </div>
    </div>

    <!-- Settings Dropdown -->
    <div class="relative">
      <button class="bg-gray-800 text-white p-2 rounded-full focus:outline-none" id="settings-button">
        <span class="material-icons">‚öôÔ∏è</span>
      </button>

      <!-- Dropdown Menu -->
      <div id="settings-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white shadow-lg rounded-lg border">
        <ul>
          <a href="{% url 'profile' %}" class="block px-4 py-2 text-gray-800 hover:bg-gray-200">Profile</a>
          </li>
¬† ¬† ¬† ¬† ¬† <li>
              <form method="POST" action="{% url 'logout' %}">
                {% csrf_token %}
                <button type="submit" 
                        class="block w-full text-left px-4 py-2 text-red-600 hover:bg-gray-100">
                    Sign out
                </button>
            </form>
            </li>
        </ul>
      </div>
    </div>
  </div>
</header>


  <nav class="bg-white">
    <div class="max-w-screen-2xl mx-auto px-6">
      <div class="grid grid-cols-4 gap-2">
        <div id="tab-teams" onclick="switchTab('teams')" 
             class="cursor-pointer flex items-center justify-center gap-2 py-3 border-b-2 border-gray-900 font-medium transition-colors">
          <span>üèÜ</span><span>Teams</span>
        </div>
        <div id="tab-players" onclick="switchTab('players')" 
             class="cursor-pointer flex items-center justify-center gap-2 py-3 text-gray-600 hover:text-gray-900 transition-colors">
          <span>üë•</span><span>Players</span>
        </div>
        <div id="tab-schedule" onclick="switchTab('schedule')" 
             class="cursor-pointer flex items-center justify-center gap-2 py-3 text-gray-600 hover:text-gray-900 transition-colors">
          <span>üìÖ</span><span>Schedule</span>
        </div>
        <div id="tab-statistics" onclick="switchTab('statistics')" 
             class="cursor-pointer flex items-center justify-center gap-2 py-3 text-gray-600 hover:text-gray-900 transition-colors">
          <span>üìä</span><span>Statistics</span>
        </div>
      </div>
    </div>
  </nav>

  <main class="flex-1 max-w-screen-2xl mx-auto px-6 py-8 w-full">

    <div id="view-teams" class="tab-content">
        <div class="flex items-center justify-between">
          <div>
            <h2 class="text-2xl font-semibold">My Teams</h2>
            <p class="text-gray-500">Manage your sports teams and rosters</p>
          </div>
    
          <button id="openModal" type="button"
                  class="inline-flex items-center gap-2 bg-gray-900 text-white px-5 py-2.5 rounded-xl hover:bg-black">
            <span class="text-lg">Ôºã</span><span>Create Team</span>
          </button>
        </div>
    
        {% if messages %}
          <ul class="mt-4 space-y-2">
            {% for m in messages %}
              <li class="text-sm rounded-md px-3 py-2 bg-blue-50 text-blue-700 border border-blue-200">{{ m }}</li>
            {% endfor %}
          </ul>
        {% endif %}
    
        {% if teams %}
          <section class="mt-8">
            <div class="grid gap-5 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4">
              {% for t in teams %}
              <a href="{% url 'team_detail' t.id %}" class="rounded-2xl border bg-white p-6 shadow-sm hover:shadow-md transition-shadow block">
                <div class="flex items-center gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                    <path d="M8 7V4h8v3"/><path d="M7 7H4a3 3 0 0 0 3 5h.5"/><path d="M17 7h3a3 3 0 0 1-3 5H16.5"/><path d="M12 14v5"/><path d="M8 22h8"/><rect x="7" y="7" width="10" height="7" rx="2"/>
                  </svg>
                  <h3 class="text-xl font-semibold">{{ t.name }}</h3>
                </div>
                <p class="mt-2 text-gray-600">
                  {{ t.sport|lower }}{% if t.season %} ‚Ä¢ {{ t.season }}{% endif %}
                </p>
                <div class="mt-4 flex items-center gap-6 text-sm text-gray-500">
                  <span class="inline-flex items-center gap-1.5">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
                      <path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                    {% with pcount=t.player_set.count %}{{ pcount }} player{{ pcount|pluralize }}{% endwith %}
                  </span>
                  <span class="inline-flex items-center gap-1.5">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
                      <rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/>
                    </svg>
                    Created {{ t.created_at|date:"n/j/Y" }}
                  </span>
                </div>
              </a>
              {% endfor %}
            </div>
          </section>
        {% else %}
          <section class="mt-8 bg-white border rounded-2xl p-10 flex flex-col items-center text-center">
            <div class="text-5xl">üèüÔ∏è</div>
            <h3 class="mt-3 text-xl font-semibold">No teams yet</h3>
            <p class="mt-2 text-gray-600">Add a new sports team to manage players and schedules.</p>
          </section>
        {% endif %}
    </div>

    <div id="view-players" class="hidden tab-content">
        <div class="flex items-center justify-between mb-6">
            <div>
              <h2 class="text-2xl font-semibold">Team Players</h2>
              <p class="text-gray-500">Manage Your Players</p>
            </div>
            
            <div>
                <select id="playerTeamFilter" onchange="filterPlayers()"
                        class="h-10 pl-3 pr-8 rounded-xl border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-gray-900">
                    <option value="all" selected>Show Team: All Teams</option>
                    {% for t in teams %}
                    <option value="{{ t.id }}">{{ t.name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        {% if all_players %}
        <div class="bg-white rounded-2xl border overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50 border-b">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Player</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Team</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Position</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jersey</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200" id="playersTableBody">
                        {% for player in all_players %}
                        <tr class="player-row hover:bg-gray-50 transition-colors" data-team-id="{{ player.team.id }}">
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center">
                                    <div class="h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 font-semibold">
                                        {{ player.first_name.0|default:player.name.0 }}{{ player.last_name.0|default:"" }}
                                    </div>
                                    <div class="ml-4">
                                        <div class="text-sm font-medium text-gray-900">
                                            {{ player.first_name|default:player.name }} {{ player.last_name|default:"" }}
                                        </div>
                                        {% if player.date_of_birth %}
                                        <div class="text-sm text-gray-500">Age: {{ player.age }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                                {{ player.team.name }}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                {{ player.position|default:"‚Äî" }}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                #{{ player.jersey_number|default:"‚Äî" }}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                    Active
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                <a href="{% url 'team_detail' player.team.id %}" class="text-blue-600 hover:text-blue-900 font-medium">
                                    Manage in Team &rarr;
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                
                <div id="noPlayersMessage" class="hidden px-6 py-12 text-center">
                    <div class="text-5xl mb-4">üë•</div>
                    <h4 class="text-lg font-semibold text-gray-900">No players found</h4>
                    <p class="text-gray-600 mt-2">No players found for the selected team.</p>
                </div>
            </div>
        </div>
        {% else %}
        <section class="mt-8 bg-white border rounded-2xl p-16 flex flex-col items-center text-center">
            <div class="text-5xl text-gray-300 mb-4">üë•</div>
            <h3 class="text-xl font-semibold text-gray-900">No players yet</h3>
            <p class="mt-2 text-gray-500">Start building your roster by adding players to your teams.</p>
        </section>
        {% endif %}
    </div>

    <div id="view-schedule" class="hidden tab-content">
        <div class="flex items-center justify-between mb-6">
            <div>
              <h2 class="text-2xl font-semibold">Team Schedule</h2>
              <p class="text-gray-500">Manage your games and practice sessions</p>
            </div>
            <div class="flex gap-3 bg-gray-100 p-1 rounded-xl">
                <button onclick="toggleScheduleView('list')" id="btn-list-view" class="px-4 py-2 rounded-lg text-sm font-medium bg-white text-gray-900 shadow-sm transition-all">
                    List View
                </button>
                <button onclick="toggleScheduleView('calendar')" id="btn-calendar-view" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-500 hover:text-gray-900 transition-all">
                    Calendar View
                </button>
                <button id="openAddEventModal" class="ml-2 px-4 py-2 bg-gray-900 text-white rounded-xl hover:bg-black font-medium transition-colors">
                    + Add Event
                </button>
            </div>
        </div>

        <div id="schedule-list-view">
            {% if upcoming_events or past_events %}
                <div class="space-y-8">
                    {% if upcoming_events %}
                    <div>
                        <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
                            <span>üìÖ</span> Upcoming Events
                        </h3>
                        <div class="grid gap-4">
                            {% for event in upcoming_events %}
                            <div class="group bg-white border border-gray-200 rounded-2xl p-5 flex items-center gap-5 hover:shadow-md transition-all hover:border-gray-300">
                                <div class="flex-shrink-0 w-20 h-20 rounded-xl flex flex-col items-center justify-center border
                                    {% if event.event_type == 'Game' %} bg-blue-50 border-blue-100 text-blue-600
                                    {% else %} bg-green-50 border-green-100 text-green-600 {% endif %}">
                                    <span class="text-xs font-bold uppercase tracking-wider">{{ event.date|date:"M" }}</span>
                                    <span class="text-2xl font-bold">{{ event.date|date:"d" }}</span>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center gap-3 mb-1">
                                        <span class="px-2.5 py-0.5 rounded-full text-xs font-semibold tracking-wide
                                            {% if event.event_type == 'Game' %} bg-blue-100 text-blue-700
                                            {% else %} bg-green-100 text-green-700 {% endif %}">
                                            {{ event.event_type|upper }}
                                        </span>
                                        <span class="text-xs font-medium text-gray-400 uppercase tracking-wider">{{ event.team.name }}</span>
                                    </div>
                                    <h4 class="text-lg font-bold text-gray-900 truncate">
                                        {% if event.event_type == 'Game' %} vs. {{ event.opponent|default:"TBD" }} {% else %} {{ event.title }} {% endif %}
                                    </h4>
                                    <div class="flex items-center gap-4 mt-1 text-sm text-gray-500 font-medium">
                                        <span>{{ event.time|time:"g:i A" }}</span>
                                        <span class="truncate">‚Ä¢ {{ event.location }}</span>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                    <button onclick="openEditEventModal('{{ event.id }}', '{{ event.title|escapejs }}', '{{ event.event_type }}', '{{ event.date|date:'Y-m-d' }}', '{{ event.time|time:'H:i' }}', '{{ event.location|escapejs }}', '{{ event.opponent|default:''|escapejs }}', '{{ event.notes|default:''|escapejs }}', '{{ event.team.id }}')" class="p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg></button>
                                    <button onclick="openDeleteEventModal('{{ event.id }}')" class="p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></button>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    {% if past_events %}
                    <div>
                        <h3 class="text-lg font-bold text-gray-400 mb-4 flex items-center gap-2"><span>üï∞Ô∏è</span> Past Events</h3>
                        <div class="grid gap-4 opacity-70 hover:opacity-100 transition-opacity">
                            {% for event in past_events %}
                            <div class="bg-gray-50 border border-gray-200 rounded-2xl p-5 flex items-center gap-5">
                                <div class="flex-shrink-0 w-20 h-20 rounded-xl flex flex-col items-center justify-center border bg-white border-gray-200 text-gray-500">
                                    <span class="text-xs font-bold uppercase tracking-wider">{{ event.date|date:"M" }}</span>
                                    <span class="text-2xl font-bold">{{ event.date|date:"d" }}</span>
                                </div>
                                <div class="flex-1">
                                    <h4 class="text-lg font-bold text-gray-700">
                                        {% if event.event_type == 'Game' %} vs. {{ event.opponent|default:"TBD" }} {% else %} {{ event.title }} {% endif %}
                                    </h4>
                                    <p class="text-sm text-gray-500 mt-1">{{ event.location }} ‚Ä¢ {{ event.time|time:"g:i A" }}</p>
                                </div>
                                <div class="flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                    <button onclick="openEditEventModal('{{ event.id }}', '{{ event.title|escapejs }}', '{{ event.event_type }}', '{{ event.date|date:'Y-m-d' }}', '{{ event.time|time:'H:i' }}', '{{ event.location|escapejs }}', '{{ event.opponent|default:''|escapejs }}', '{{ event.notes|default:''|escapejs }}', '{{ event.team.id }}')" class="p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg></button>
                                    <button onclick="openDeleteEventModal('{{ event.id }}')" class="p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></button>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            {% else %}
                <section class="mt-8 bg-white border rounded-2xl p-16 flex flex-col items-center text-center">
                    <div class="text-5xl text-gray-300 mb-4">üìÖ</div>
                    <h3 class="text-xl font-semibold text-gray-900">No event Scheduled</h3>
                    <p class="mt-2 text-gray-500">Schedule your first game or practice session to see it here.</p>
                </section>
            {% endif %}
        </div>

        <div id="schedule-calendar-view" class="hidden">
            <div class="bg-white border border-gray-200 rounded-2xl p-6 shadow-sm">
                <div class="flex items-center justify-between mb-6">
                    <h3 id="currentMonthYear" class="text-xl font-bold text-gray-900">November 2025</h3>
                    <div class="flex gap-2">
                        <button onclick="changeMonth(-1)" class="p-2 rounded-lg hover:bg-gray-100 text-gray-600">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
                        </button>
                        <button onclick="changeMonth(1)" class="p-2 rounded-lg hover:bg-gray-100 text-gray-600">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
                        </button>
                    </div>
                </div>
                <div class="grid grid-cols-7 text-center text-sm font-medium text-gray-400 mb-2">
                    <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
                </div>
                <div id="calendarGrid" class="grid grid-cols-7 gap-2"></div>
                <div class="mt-6 flex items-center gap-4 text-sm border-t pt-4">
                    <div class="flex items-center gap-2">
                        <span class="w-3 h-3 rounded-full bg-blue-500"></span> <span class="text-gray-600">Game</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="w-3 h-3 rounded-full bg-green-500"></span> <span class="text-gray-600">Practice</span>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div id="view-statistics" class="hidden tab-content">
        <div class="flex items-center justify-between mb-6">
            <div>
              <h2 class="text-2xl font-semibold">Player Statistics Each Game</h2>
              <p class="text-gray-500">Manage your Statistics</p>
            </div>
        </div>
        <section class="mt-8 bg-white border rounded-2xl p-16 flex flex-col items-center text-center">
            <div class="text-5xl text-gray-300 mb-4">üìä</div>
            <h3 class="text-xl font-semibold text-gray-900">No Players and games available</h3>
            <p class="mt-2 text-gray-500 max-w-md">
                Add players on your team and a game in schedule first before you can start tracking statistics
            </p>
        </section>
    </div>

  </main>

  <div id="modal" class="hidden fixed inset-0 bg-black/60 z-50">
    <div class="min-h-full flex items-center justify-center p-4">
      <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl">
        <div class="flex items-start justify-between px-6 py-5 border-b">
          <div>
            <h3 class="text-2xl font-semibold leading-6">Create New Team</h3>
            <p class="mt-1 text-sm text-gray-500">
              Add a new sports team to manage players and schedules.
            </p>
          </div>
          <button id="closeModal" type="button" class="text-gray-500 hover:text-gray-700 text-2xl leading-none">&times;</button>
        </div>

        <form method="post" action="" class="px-6 py-6 space-y-6">
          {% csrf_token %}
          <label class="block">
            <span class="text-sm font-medium">Team Name</span>
            <input id="teamName" name="team_name" type="text" placeholder="Enter team name"
              class="mt-2 block w-full h-12 px-4 text-base rounded-xl border border-gray-300 bg-white
                     focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
          </label>

          <label class="block">
            <span class="text-sm font-medium">Sport</span>
            <select name="sport"
              class="mt-2 block w-full h-12 px-4 text-base rounded-xl border border-gray-300 bg-white
                     focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
              <option value="" selected disabled>Select a sport</option>
              <option>Basketball</option>
              <option>Football</option>
              <option>Soccer</option>
              <option>Baseball</option>
              <option>Volleyball</option>
              <option>Track &amp; Field</option>
              <option>Tennis</option>
              <option>Swimming</option>
              <option>Other</option>
            </select>
          </label>

          <label class="block">
            <span class="text-sm font-medium">Season</span>
            <input name="season" type="text" placeholder="e.g., Fall 2024, Spring 2025"
              class="mt-2 block w-full h-12 px-4 text-base rounded-xl border border-gray-300 bg-white
                     focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </label>

          <div class="flex items-center justify-end gap-3 pt-2">
            <button type="button" id="cancelModal"
              class="px-4 h-11 rounded-xl border border-gray-300 bg-white hover:bg-gray-50">Cancel</button>
            <button class="px-5 h-11 rounded-xl bg-gray-900 text-white hover:bg-black">Create Team</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div id="addEventModal" class="hidden fixed inset-0 bg-black/60 z-50 overflow-y-auto">
  <div class="min-h-full flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg">
      
      <div class="flex items-start justify-between px-6 py-5 border-b">
        <div>
          <h3 class="text-2xl font-bold leading-6 text-gray-900">Create New Event</h3>
          <p class="mt-1 text-sm text-gray-500">Schedule a new game or practice session.</p>
        </div>
        <button id="closeAddEventModal" type="button" class="text-gray-400 hover:text-gray-600 text-3xl leading-none">&times;</button>
      </div>

      <form method="post" action="{% url 'add_event' %}" class="px-6 py-6 space-y-5">
        {% csrf_token %}
        
        <div>
          <label class="block text-sm font-bold text-gray-900 mb-1">Team</label>
          <div class="relative">
            <select name="team_id" class="block w-full h-12 pl-4 pr-8 text-base border border-gray-300 rounded-xl focus:outline-none focus:border-black focus:ring-1 focus:ring-black appearance-none bg-white" required>
              <option value="" disabled selected>Select a team</option>
              {% for t in teams %}
                <option value="{{ t.id }}">{{ t.name }}</option>
              {% endfor %}
            </select>
            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-gray-500">
              <svg class="h-4 w-4 fill-current" viewBox="0 0 20 20"><path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/></svg>
            </div>
          </div>
        </div>

        <div>
          <label class="block text-sm font-bold text-gray-900 mb-1">Event Title</label>
          <input type="text" name="title" placeholder="Enter event title" class="block w-full h-12 px-4 text-base border border-gray-300 rounded-xl focus:outline-none focus:border-black focus:ring-1 focus:ring-black" required>
        </div>

        <div>
            <label class="block text-sm font-bold text-gray-900 mb-2">Event Type</label>
            <div class="flex items-center gap-6">
                <label class="inline-flex items-center cursor-pointer">
                    <input type="radio" name="event_type" value="Game" class="w-5 h-5 text-blue-600 border-gray-300 focus:ring-blue-500" checked required>
                    <span class="ml-2 text-base font-medium text-gray-900">Game</span>
                </label>
                <label class="inline-flex items-center cursor-pointer">
                    <input type="radio" name="event_type" value="Practice" class="w-5 h-5 text-green-600 border-gray-300 focus:ring-green-500">
                    <span class="ml-2 text-base font-medium text-gray-900">Practice</span>
                </label>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div>
                <label class="block text-sm font-bold text-gray-900 mb-1">Date</label>
                <input type="date" name="date" class="block w-full h-12 px-4 text-base border border-gray-300 rounded-xl focus:outline-none focus:border-black focus:ring-1 focus:ring-black" required>
            </div>
            <div>
                <label class="block text-sm font-bold text-gray-900 mb-1">Time</label>
                <input type="time" name="time" class="block w-full h-12 px-4 text-base border border-gray-300 rounded-xl focus:outline-none focus:border-black focus:ring-1 focus:ring-black" required>
            </div>
        </div>

        <div>
            <label class="block text-sm font-bold text-gray-900 mb-1">Location</label>
            <input type="text" name="location" placeholder="Event Location" class="block w-full h-12 px-4 text-base border border-gray-300 rounded-xl focus:outline-none focus:border-black focus:ring-1 focus:ring-black" required>
        </div>

        <div>
            <label class="block text-sm font-bold text-gray-900 mb-1">Opponent (Games Only)</label>
            <input type="text" name="opponent" placeholder="Opposing Team" class="block w-full h-12 px-4 text-base border border-gray-300 rounded-xl focus:outline-none focus:border-black focus:ring-1 focus:ring-black">
        </div>

        <div>
            <label class="block text-sm font-bold text-gray-900 mb-1">Notes</label>
            <textarea name="notes" rows="3" placeholder="Additional notes..." class="block w-full p-4 text-base border border-gray-300 rounded-xl focus:outline-none focus:border-black focus:ring-1 focus:ring-black resize-none"></textarea>
        </div>

        <div class="flex items-center justify-end gap-3 pt-2">
          <button type="button" id="cancelAddEventModal" class="px-6 h-12 rounded-xl border border-gray-300 text-gray-700 font-semibold hover:bg-gray-50 transition-colors">
            Cancel
          </button>
          <button type="submit" class="px-6 h-12 rounded-xl bg-black text-white font-semibold hover:bg-gray-900 transition-colors">
            Create Event
          </button>
        </div>

      </form>
    </div>
  </div>
  </div>

  <div id="editEventModal" class="hidden fixed inset-0 bg-black/60 z-50 overflow-y-auto">
    <div class="min-h-full flex items-center justify-center p-4">
      <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg">
        <div class="flex items-start justify-between px-6 py-5 border-b">
          <h3 class="text-2xl font-bold leading-6 text-gray-900">Edit Event</h3>
          <button id="closeEditEventModal" type="button" class="text-gray-400 hover:text-gray-600 text-3xl leading-none">&times;</button>
        </div>
        <form id="editEventForm" method="post" class="px-6 py-6 space-y-5">
          {% csrf_token %}
          
          <div>
            <label class="block text-sm font-bold text-gray-900 mb-1">Team</label>
            <select id="edit_team_id" name="team_id" class="block w-full h-12 pl-4 pr-8 text-base border border-gray-300 rounded-xl focus:outline-none focus:border-black" required>
              {% for t in teams %}
                <option value="{{ t.id }}">{{ t.name }}</option>
              {% endfor %}
            </select>
          </div>

          <div>
            <label class="block text-sm font-bold text-gray-900 mb-1">Event Title</label>
            <input id="edit_title" type="text" name="title" class="block w-full h-12 px-4 text-base border border-gray-300 rounded-xl focus:outline-none focus:border-black" required>
          </div>

          <div>
              <label class="block text-sm font-bold text-gray-900 mb-2">Event Type</label>
              <div class="flex items-center gap-6">
                  <label class="inline-flex items-center cursor-pointer">
                      <input type="radio" id="edit_type_game" name="event_type" value="Game" class="w-5 h-5 text-blue-600 border-gray-300 focus:ring-blue-500">
                      <span class="ml-2 text-base font-medium text-gray-900">Game</span>
                  </label>
                  <label class="inline-flex items-center cursor-pointer">
                      <input type="radio" id="edit_type_practice" name="event_type" value="Practice" class="w-5 h-5 text-green-600 border-gray-300 focus:ring-green-500">
                      <span class="ml-2 text-base font-medium text-gray-900">Practice</span>
                  </label>
              </div>
          </div>

          <div class="grid grid-cols-2 gap-4">
              <div>
                  <label class="block text-sm font-bold text-gray-900 mb-1">Date</label>
                  <input id="edit_date" type="date" name="date" class="block w-full h-12 px-4 text-base border border-gray-300 rounded-xl focus:outline-none focus:border-black" required>
              </div>
              <div>
                  <label class="block text-sm font-bold text-gray-900 mb-1">Time</label>
                  <input id="edit_time" type="time" name="time" class="block w-full h-12 px-4 text-base border border-gray-300 rounded-xl focus:outline-none focus:border-black" required>
              </div>
          </div>

          <div>
              <label class="block text-sm font-bold text-gray-900 mb-1">Location</label>
              <input id="edit_location" type="text" name="location" class="block w-full h-12 px-4 text-base border border-gray-300 rounded-xl focus:outline-none focus:border-black" required>
          </div>

          <div>
              <label class="block text-sm font-bold text-gray-900 mb-1">Opponent</label>
              <input id="edit_opponent" type="text" name="opponent" class="block w-full h-12 px-4 text-base border border-gray-300 rounded-xl focus:outline-none focus:border-black">
          </div>

          <div>
              <label class="block text-sm font-bold text-gray-900 mb-1">Notes</label>
              <textarea id="edit_notes" name="notes" rows="3" class="block w-full p-4 text-base border border-gray-300 rounded-xl focus:outline-none focus:border-black resize-none"></textarea>
          </div>

          <div class="flex items-center justify-end gap-3 pt-2">
            <button type="button" id="cancelEditEventModal" class="px-6 h-12 rounded-xl border border-gray-300 text-gray-700 font-semibold hover:bg-gray-50">Cancel</button>
            <button type="submit" class="px-6 h-12 rounded-xl bg-black text-white font-semibold hover:bg-gray-900">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div id="deleteEventModal" class="hidden fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4">
      <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6">
          <div class="text-center">
              <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4">
                  <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                  </svg>
              </div>
              <h3 class="text-lg leading-6 font-medium text-gray-900">Delete Event?</h3>
              <p class="text-sm text-gray-500 mt-2">
                  Are you sure you want to delete this event? This action cannot be undone.
              </p>
          </div>
          <div class="mt-5 sm:mt-6 flex gap-3">
              <button id="cancelDeleteEvent" type="button" class="w-full inline-flex justify-center rounded-xl border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 sm:text-sm">
                  Cancel
              </button>
              <form id="deleteEventForm" method="post" class="w-full">
                  {% csrf_token %}
                  <button type="submit" class="w-full inline-flex justify-center rounded-xl border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 sm:text-sm">
                      Delete
                  </button>
              </form>
          </div>
      </div>
  </div>

  <script>
    // --- Data passed from Django ---
    const rawEvents = '{{ events_json|safe }}'; 
    const allEvents = rawEvents ? JSON.parse(rawEvents) : [];

    // --- Tab Logic ---
    function switchTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(view => view.classList.add('hidden'));
        const selectedView = document.getElementById('view-' + tabName);
        if (selectedView) selectedView.classList.remove('hidden');
        const tabs = ['teams', 'players', 'schedule', 'statistics'];
        tabs.forEach(t => {
            const btn = document.getElementById('tab-' + t);
            if (t === tabName) {
                btn.className = "cursor-pointer flex items-center justify-center gap-2 py-3 border-b-2 border-gray-900 font-medium transition-colors";
                btn.classList.remove('text-gray-600');
            } else {
                btn.className = "cursor-pointer flex items-center justify-center gap-2 py-3 text-gray-600 hover:text-gray-900 transition-colors";
            }
        });
    }

    // --- Filter Players ---
    function filterPlayers() {
        const filterValue = document.getElementById('playerTeamFilter').value;
        const rows = document.querySelectorAll('.player-row');
        const noPlayersMsg = document.getElementById('noPlayersMessage');
        let visibleCount = 0;
        rows.forEach(row => {
            if (filterValue === 'all' || row.dataset.teamId === filterValue) {
                row.style.display = ''; 
                visibleCount++;
            } else {
                row.style.display = 'none'; 
            }
        });
        if (noPlayersMsg) {
            if (visibleCount === 0 && rows.length > 0) noPlayersMsg.classList.remove('hidden');
            else noPlayersMsg.classList.add('hidden');
        }
    }

    // --- Toggle Schedule View ---
    function toggleScheduleView(viewType) {
        const listView = document.getElementById('schedule-list-view');
        const calendarView = document.getElementById('schedule-calendar-view');
        const btnList = document.getElementById('btn-list-view');
        const btnCal = document.getElementById('btn-calendar-view');

        if (viewType === 'list') {
            listView.classList.remove('hidden');
            calendarView.classList.add('hidden');
            btnList.className = "px-4 py-2 rounded-lg text-sm font-medium bg-white text-gray-900 shadow-sm transition-all";
            btnCal.className = "px-4 py-2 rounded-lg text-sm font-medium text-gray-500 hover:text-gray-900 transition-all";
        } else {
            listView.classList.add('hidden');
            calendarView.classList.remove('hidden');
            btnCal.className = "px-4 py-2 rounded-lg text-sm font-medium bg-white text-gray-900 shadow-sm transition-all";
            btnList.className = "px-4 py-2 rounded-lg text-sm font-medium text-gray-500 hover:text-gray-900 transition-all";
            renderCalendar();
        }
    }

    // --- Calendar Logic ---
    let currentDate = new Date();
    function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        document.getElementById('currentMonthYear').innerText = `${monthNames[month]} ${year}`;

        const grid = document.getElementById('calendarGrid');
        grid.innerHTML = ""; 

        for (let i = 0; i < firstDay; i++) {
            const emptyCell = document.createElement('div');
            emptyCell.className = "bg-gray-50/50 border border-transparent rounded-xl"; 
            grid.appendChild(emptyCell);
        }

        for (let day = 1; day <= daysInMonth; day++) {
            const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const daysEvents = allEvents.filter(e => e.date === dateStr);

            const cell = document.createElement('div');
            cell.className = "calendar-day border border-gray-100 rounded-xl p-2 flex flex-col gap-1 hover:bg-gray-50 transition-colors relative group cursor-pointer";
            
            const isToday = dateStr === new Date().toISOString().split('T')[0];
            let dayHTML = `<div class="flex justify-between items-start">
                             <span class="text-sm font-semibold ${isToday ? 'bg-black text-white w-7 h-7 rounded-full flex items-center justify-center shadow-md' : 'text-gray-700 px-1'}">${day}</span>
                           </div>`;
            
            let eventsHTML = "";
            if (daysEvents.length > 0) {
                daysEvents.sort((a, b) => a.time.localeCompare(b.time));
                daysEvents.forEach(e => {
                    const bgClass = e.type === 'Game' ? 'bg-blue-100 text-blue-700 border-blue-200' : 'bg-green-100 text-green-700 border-green-200';
                    eventsHTML += `
                        <div onclick="openEditEventModal('${e.id}', '${e.title}', '${e.type}', '${e.date}', '${e.time}', '${e.location}', '${e.opponent || ''}', '${e.notes || ''}', '${e.team_id}')" 
                             class="${bgClass} border px-2 py-1 rounded-md text-xs font-medium truncate cursor-pointer hover:opacity-80 transition-opacity">
                            <span class="font-bold mr-1">${e.time.slice(0, 5)}</span>
                            ${e.type === 'Game' ? 'vs ' + (e.opponent || 'TBD') : e.title}
                        </div>
                    `;
                });
            }

            cell.innerHTML = dayHTML + `<div class="flex flex-col gap-1 mt-1">${eventsHTML}</div>`;
            grid.appendChild(cell);
        }
    }

    function changeMonth(step) {
        currentDate.setMonth(currentDate.getMonth() + step);
        renderCalendar();
    }

    // --- Edit Event Modal Logic ---
    const editEventModal = document.getElementById('editEventModal');
    const closeEditEventBtn = document.getElementById('closeEditEventModal');
    const cancelEditEventBtn = document.getElementById('cancelEditEventModal');
    function openEditEventModal(id, title, type, date, time, location, opponent, notes, teamId) {
        document.getElementById('editEventForm').action = `/coach/event/${id}/edit/`;
        document.getElementById('edit_title').value = title;
        document.getElementById('edit_date').value = date;
        document.getElementById('edit_time').value = time;
        document.getElementById('edit_location').value = location;
        document.getElementById('edit_opponent').value = opponent;
        document.getElementById('edit_notes').value = notes;
        document.getElementById('edit_team_id').value = teamId;
        if (type === 'Game') document.getElementById('edit_type_game').checked = true;
        else document.getElementById('edit_type_practice').checked = true;
        editEventModal.classList.remove('hidden');
    }
    function hideEditEventModal() { editEventModal.classList.add('hidden'); }
    if(closeEditEventBtn) closeEditEventBtn.addEventListener('click', hideEditEventModal);
    if(cancelEditEventBtn) cancelEditEventBtn.addEventListener('click', hideEditEventModal);

    // --- Delete Event Modal Logic ---
    const deleteEventModal = document.getElementById('deleteEventModal');
    const cancelDeleteEventBtn = document.getElementById('cancelDeleteEvent');
    function openDeleteEventModal(id) {
        document.getElementById('deleteEventForm').action = `/coach/event/${id}/delete/`;
        deleteEventModal.classList.remove('hidden');
    }
    function hideDeleteEventModal() { deleteEventModal.classList.add('hidden'); }
    if(cancelDeleteEventBtn) cancelDeleteEventBtn.addEventListener('click', hideDeleteEventModal);

    // --- Main Init ---
    document.addEventListener('DOMContentLoaded', () => {
      const urlParams = new URLSearchParams(window.location.search);
      const activeTab = urlParams.get('tab');
      if (activeTab) switchTab(activeTab);

      // Team Modal
      const modal = document.getElementById('modal');
      const open1 = document.getElementById('openModal');
      const close = document.getElementById('closeModal');
      const cancel = document.getElementById('cancelModal');
      const teamName = document.getElementById('teamName');
      function showTeamModal(){ modal.classList.remove('hidden'); setTimeout(()=>teamName?.focus(), 0); }
      function hideTeamModal(){ modal.classList.add('hidden'); }
      if(open1) open1.addEventListener('click', showTeamModal);
      if(close) close.addEventListener('click', hideTeamModal);
      if(cancel) cancel.addEventListener('click', hideTeamModal);
      if(modal) modal.addEventListener('click', e => { if (e.target === modal) hideTeamModal(); });

      // Add Event Modal
      const addEventModal = document.getElementById('addEventModal');
      const openAddEventBtn = document.getElementById('openAddEventModal');
      const closeAddEventBtn = document.getElementById('closeAddEventModal');
      const cancelAddEventBtn = document.getElementById('cancelAddEventModal');
      function showEventModal() { addEventModal.classList.remove('hidden'); }
      function hideEventModal() { addEventModal.classList.add('hidden'); }
      if(openAddEventBtn) openAddEventBtn.addEventListener('click', showEventModal);
      if(closeAddEventBtn) closeAddEventBtn.addEventListener('click', hideEventModal);
      if(cancelAddEventBtn) cancelAddEventBtn.addEventListener('click', hideEventModal);
      if(addEventModal) addEventModal.addEventListener('click', (e) => { if (e.target === addEventModal) hideEventModal(); });

      document.addEventListener('keydown', e => { 
          if (e.key === 'Escape') {
              hideTeamModal();
              hideEventModal();
              hideEditEventModal();
              hideDeleteEventModal();
          }
      });
    });
  </script>
<script>
  // Existing event listener logic (your previous code)
  document.addEventListener('keydown', e => { 
    if (e.key === 'Escape') {
      hideTeamModal();
      hideEventModal();
      hideEditEventModal();
      hideDeleteEventModal();
    }
  });

  // --- Dropdown logic for Settings Button ---
  const settingsButton = document.getElementById("settings-button");
  const dropdown = document.getElementById("settings-dropdown");

  // Toggle dropdown visibility on settings button click
  settingsButton.addEventListener("click", function() {
    dropdown.classList.toggle("hidden");
  });

  // Close dropdown if clicked outside
  window.addEventListener("click", function(event) {
    if (!settingsButton.contains(event.target) && !dropdown.contains(event.target)) {
      dropdown.classList.add("hidden");
    }
  });
</script>


</body>
</html>
